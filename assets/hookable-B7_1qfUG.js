function f(h,e={},t){for(const o in h){const s=h[o],i=t?`${t}:${o}`:o;typeof s=="object"&&s!==null?f(s,e,i):typeof s=="function"&&(e[i]=s)}return e}const l={run:h=>h()},a=()=>l,c=typeof console.createTask<"u"?console.createTask:a;function k(h,e){const t=e.shift(),o=c(t);return h.reduce((s,i)=>s.then(()=>o.run(()=>i(...e))),Promise.resolve())}function d(h,e){const t=e.shift(),o=c(t);return Promise.all(h.map(s=>o.run(()=>s(...e))))}function n(h,e){for(const t of[...h])t(e)}class _{constructor(){this._hooks={},this._before=void 0,this._after=void 0,this._deprecatedMessages=void 0,this._deprecatedHooks={},this.hook=this.hook.bind(this),this.callHook=this.callHook.bind(this),this.callHookWith=this.callHookWith.bind(this)}hook(e,t,o={}){if(!e||typeof t!="function")return()=>{};const s=e;let i;for(;this._deprecatedHooks[e];)i=this._deprecatedHooks[e],e=i.to;if(i&&!o.allowDeprecated){let r=i.message;r||(r=`${s} hook has been deprecated`+(i.to?`, please use ${i.to}`:"")),this._deprecatedMessages||(this._deprecatedMessages=new Set),this._deprecatedMessages.has(r)||(console.warn(r),this._deprecatedMessages.add(r))}if(!t.name)try{Object.defineProperty(t,"name",{get:()=>"_"+e.replace(/\W+/g,"_")+"_hook_cb",configurable:!0})}catch{}return this._hooks[e]=this._hooks[e]||[],this._hooks[e].push(t),()=>{t&&(this.removeHook(e,t),t=void 0)}}hookOnce(e,t){let o,s=(...i)=>(typeof o=="function"&&o(),o=void 0,s=void 0,t(...i));return o=this.hook(e,s),o}removeHook(e,t){if(this._hooks[e]){const o=this._hooks[e].indexOf(t);o!==-1&&this._hooks[e].splice(o,1),this._hooks[e].length===0&&delete this._hooks[e]}}deprecateHook(e,t){this._deprecatedHooks[e]=typeof t=="string"?{to:t}:t;const o=this._hooks[e]||[];delete this._hooks[e];for(const s of o)this.hook(e,s)}deprecateHooks(e){Object.assign(this._deprecatedHooks,e);for(const t in e)this.deprecateHook(t,e[t])}addHooks(e){const t=f(e),o=Object.keys(t).map(s=>this.hook(s,t[s]));return()=>{for(const s of o.splice(0,o.length))s()}}removeHooks(e){const t=f(e);for(const o in t)this.removeHook(o,t[o])}removeAllHooks(){for(const e in this._hooks)delete this._hooks[e]}callHook(e,...t){return t.unshift(e),this.callHookWith(k,e,...t)}callHookParallel(e,...t){return t.unshift(e),this.callHookWith(d,e,...t)}callHookWith(e,t,...o){const s=this._before||this._after?{name:t,args:o,context:{}}:void 0;this._before&&n(this._before,s);const i=e(t in this._hooks?[...this._hooks[t]]:[],o);return i instanceof Promise?i.finally(()=>{this._after&&s&&n(this._after,s)}):(this._after&&s&&n(this._after,s),i)}beforeEach(e){return this._before=this._before||[],this._before.push(e),()=>{if(this._before!==void 0){const t=this._before.indexOf(e);t!==-1&&this._before.splice(t,1)}}}afterEach(e){return this._after=this._after||[],this._after.push(e),()=>{if(this._after!==void 0){const t=this._after.indexOf(e);t!==-1&&this._after.splice(t,1)}}}}function u(){return new _}export{u as c};
