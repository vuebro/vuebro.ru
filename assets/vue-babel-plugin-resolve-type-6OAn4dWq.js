import{l as E}from"./babel-parser-BdUoaBUX.js";import{e as v,a as b}from"./vue-compiler-sfc-C0Gwr7XH.js";import{l as h}from"./babel-code-frame-CF4WPE1y.js";import{l as C}from"./babel-helper-module-imports-DoEuVeLX.js";import{l as D}from"./babel-helper-plugin-utils-DJaLuuN1.js";var I=D.declare(({types:e},s)=>{let i,l;return{name:"babel-plugin-resolve-type",pre(t){const o=t.opts.filename||"unknown.js";l=new Set,i={filename:o,source:t.code,options:s,ast:t.ast.program.body,isCE:!1,error(n,r){throw new Error(`[@vue/babel-plugin-resolve-type] ${n}

${o}
${h.codeFrameColumns(t.code,{start:{line:r.loc.start.line,column:r.loc.start.column+1},end:{line:r.loc.end.line,column:r.loc.end.column+1}})}`)},helper(n){return l.add(n),`_${n}`},getString(n){return t.code.slice(n.start,n.end)},propsTypeDecl:void 0,propsRuntimeDefaults:void 0,propsDestructuredBindings:{},emitsTypeDecl:void 0}},visitor:{CallExpression(t){if(!i)throw new Error("[@vue/babel-plugin-resolve-type] context is not loaded.");const{node:o}=t;if(!e.isIdentifier(o.callee,{name:"defineComponent"})||!c(t))return;const n=o.arguments[0];if(!n||!e.isFunction(n))return;let r=o.arguments[1];r||(r=e.objectExpression([]),o.arguments.push(r)),o.arguments[1]=d(n,r)||r,o.arguments[1]=y(n,o.arguments[1])||r},VariableDeclarator(t){f(t)}},post(t){for(const o of l)C.addNamed(t.path,`_${o}`,"vue")}};function f(t){var o;const n=t.get("id"),r=t.get("init");if(!n||!n.isIdentifier()||!r||!r.isCallExpression()||!((o=r.get("callee"))!=null&&o.isIdentifier({name:"defineComponent"}))||!c(r))return;const p=e.objectProperty(e.identifier("name"),e.stringLiteral(n.node.name)),{arguments:a}=r.node;a.length!==0&&(a.length===1&&r.node.arguments.push(e.objectExpression([])),a[1]=m(e,a[1],p))}function d(t,o){const n=t.params[0];if(!n||(n.type==="AssignmentPattern"?(i.propsTypeDecl=u(n.left),i.propsRuntimeDefaults=n.right):i.propsTypeDecl=u(n),!i.propsTypeDecl))return;const r=v(i);if(!r)return;const p=E.parseExpression(r);return m(e,o,e.objectProperty(e.identifier("props"),p))}function y(t,o){var n;const r=t.params[1]&&u(t.params[1]);if(!r||!e.isTSTypeReference(r)||!e.isIdentifier(r.typeName,{name:"SetupContext"}))return;const p=(n=r.typeParameters)==null?void 0:n.params[0];if(!p)return;i.emitsTypeDecl=p;const a=b(i),g=e.arrayExpression(Array.from(a).map(x=>e.stringLiteral(x)));return m(e,o,e.objectProperty(e.identifier("emits"),g))}});function u(e){if("typeAnnotation"in e&&e.typeAnnotation&&e.typeAnnotation.type==="TSTypeAnnotation")return e.typeAnnotation.typeAnnotation}function c(e){var s;const i=(s=e.scope.getBinding("defineComponent"))==null?void 0:s.path.parent;return i?i.type==="ImportDeclaration"&&/^@?vue(\/|$)/.test(i.source.value):!0}function m(e,s,i){if(e.isObjectExpression(s))s.properties.unshift(i);else if(e.isExpression(s))return e.objectExpression([i,e.spreadElement(s)]);return s}export{I as i};
