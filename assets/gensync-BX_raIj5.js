var h,_;function Y(){if(_)return h;_=1;const E=Symbol.for("gensync:v1:start"),N=Symbol.for("gensync:v1:suspend"),C="GENSYNC_EXPECTED_START",O="GENSYNC_EXPECTED_SUSPEND",m="GENSYNC_OPTIONS_ERROR",S="GENSYNC_RACE_NONEMPTY",P="GENSYNC_ERRBACK_NO_CALLBACK";h=Object.assign(function(e){let n=e;return typeof e!="function"?n=A(e):n=G(e),Object.assign(n,w(n))},{all:y({name:"all",arity:1,sync:function(t){return Array.from(t[0]).map(n=>p(n))},async:function(t,e,n){const r=Array.from(t[0]);if(r.length===0){Promise.resolve().then(()=>e([]));return}let i=0;const o=r.map(()=>{});r.forEach((c,u)=>{a(c,l=>{o[u]=l,i+=1,i===o.length&&e(o)},n)})}}),race:y({name:"race",arity:1,sync:function(t){const e=Array.from(t[0]);if(e.length===0)throw s("Must race at least 1 item",S);return p(e[0])},async:function(t,e,n){const r=Array.from(t[0]);if(r.length===0)throw s("Must race at least 1 item",S);for(const i of r)a(i,e,n)}})});function w(t){return{sync:function(...n){return p(t.apply(this,n))},async:function(...n){return new Promise((r,i)=>{a(t.apply(this,n),r,i)})},errback:function(...n){const r=n.pop();if(typeof r!="function")throw s("Asynchronous function called without callback",P);let i;try{i=t.apply(this,n)}catch(o){r(o);return}a(i,o=>r(void 0,o),o=>r(o))}}}function f(t,e,n,r){if(typeof n===t||r&&typeof n>"u")return;let i;throw r?i=`Expected opts.${e} to be either a ${t}, or undefined.`:i=`Expected opts.${e} to be a ${t}.`,s(i,m)}function s(t,e){return Object.assign(new Error(t),{code:e})}function A({name:t,arity:e,sync:n,async:r,errback:i}){if(f("string","name",t,!0),f("number","arity",e,!0),f("function","sync",n),f("function","async",r,!0),f("function","errback",i,!0),r&&i)throw s("Expected one of either opts.async or opts.errback, but got _both_.",m);if(typeof t!="string"){let o;i&&i.name&&i.name!=="errback"&&(o=i.name),r&&r.name&&r.name!=="async"&&(o=r.name.replace(/Async$/,"")),n&&n.name&&n.name!=="sync"&&(o=n.name.replace(/Sync$/,"")),typeof o=="string"&&(t=o)}return typeof e!="number"&&(e=n.length),y({name:t,arity:e,sync:function(o){return n.apply(this,o)},async:function(o,c,u){r?r.apply(this,o).then(c,u):i?i.call(this,...o,(l,T)=>{l==null?c(T):u(l)}):c(n.apply(this,o))}})}function G(t){return b(t.name,t.length,function(...e){return t.apply(this,e)})}function y({name:t,arity:e,sync:n,async:r}){return b(t,e,function*(...i){const o=yield E;if(!o)return n.call(this,i);let c;try{r.call(this,i,u=>{c||(c={value:u},o())},u=>{c||(c={err:u},o())})}catch(u){c={err:u},o()}if(yield N,c.hasOwnProperty("err"))throw c.err;return c.value})}function p(t){let e;for(;!({value:e}=t.next()).done;)d(e,t);return e}function a(t,e,n){(function r(){try{let i;for(;!({value:i}=t.next()).done;){d(i,t);let o=!0,c=!1;const u=t.next(()=>{o?c=!0:r()});if(o=!1,R(u,t),!c)return}return e(i)}catch(i){return n(i)}})()}function d(t,e){t!==E&&g(e,s(`Got unexpected yielded value in gensync generator: ${JSON.stringify(t)}. Did you perhaps mean to use 'yield*' instead of 'yield'?`,C))}function R({value:t,done:e},n){!e&&t===N||g(n,s(e?"Unexpected generator completion. If you get this, it is probably a gensync bug.":`Expected GENSYNC_SUSPEND, got ${JSON.stringify(t)}. If you get this, it is probably a gensync bug.`,O))}function g(t,e){throw t.throw&&t.throw(e),e}function b(t,e,n){if(typeof t=="string"){const r=Object.getOwnPropertyDescriptor(n,"name");(!r||r.configurable)&&Object.defineProperty(n,"name",Object.assign(r||{},{configurable:!0,value:t}))}if(typeof e=="number"){const r=Object.getOwnPropertyDescriptor(n,"length");(!r||r.configurable)&&Object.defineProperty(n,"length",Object.assign(r||{},{configurable:!0,value:e}))}return n}return h}export{Y as r};
