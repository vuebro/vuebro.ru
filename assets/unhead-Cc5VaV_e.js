import{c as F}from"./hookable-B7_1qfUG.js";const G=new Set(["link","style","script","noscript"]),N=new Set(["title","titleTemplate","script","style","noscript"]),$=new Set(["base","meta","link","style","script","noscript"]),J=new Set(["title","base","htmlAttrs","bodyAttrs","meta","link","style","script","noscript"]),B=new Set(["base","title","titleTemplate","bodyAttrs","htmlAttrs","templateParams"]),Q=new Set(["key","tagPosition","tagPriority","tagDuplicateStrategy","innerHTML","textContent","processTemplateParams"]),Z=new Set(["templateParams","htmlAttrs","bodyAttrs"]),P=new Set(["theme-color","google-site-verification","og","article","book","profile","twitter","author"]),X=["name","property","http-equiv"];function K(e){const t=e.split(":")[1];return P.has(t)}function E(e){const{props:t,tag:n}=e;if(B.has(n))return n;if(n==="link"&&t.rel==="canonical")return"canonical";if(t.charset)return"charset";if(e.tag==="meta"){for(const s of X)if(t[s]!==void 0)return`${n}:${t[s]}`}if(e.key)return`${n}:key:${e.key}`;if(t.id)return`${n}:id:${t.id}`;if(N.has(n)){const s=e.textContent||e.innerHTML;if(s)return`${n}:content:${s}`}}function O(e){const t=e._h||e._d;if(t)return t;const n=e.textContent||e.innerHTML;return n||`${e.tag}:${Object.entries(e.props).map(([s,o])=>`${s}:${String(o)}`).join(",")}`}function H(e,t,n){typeof e==="function"&&(!n||n!=="titleTemplate"&&!(n[0]==="o"&&n[1]==="n"))&&(e=e());let o;if(t&&(o=t(n,e)),Array.isArray(o))return o.map(c=>H(c,t));if((o==null?void 0:o.constructor)===Object){const c={};for(const i of Object.keys(o))c[i]=H(o[i],t,i);return c}return o}function Y(e,t){const n=e==="style"?new Map:new Set;function s(o){const c=o.trim();if(c)if(e==="style"){const[i,...f]=c.split(":").map(p=>p.trim());i&&f.length&&n.set(i,f.join(":"))}else c.split(" ").filter(Boolean).forEach(i=>n.add(i))}return typeof t=="string"?e==="style"?t.split(";").forEach(s):s(t):Array.isArray(t)?t.forEach(o=>s(o)):t&&typeof t=="object"&&Object.entries(t).forEach(([o,c])=>{c&&c!=="false"&&(e==="style"?n.set(o.trim(),c):s(o))}),n}function R(e,t){return e.props=e.props||{},t&&Object.entries(t).forEach(([n,s])=>{if(s===null){e.props[n]=null;return}if(n==="class"||n==="style"){e.props[n]=Y(n,s);return}if(Q.has(n)){if(["textContent","innerHTML"].includes(n)&&typeof s=="object"){let i=t.type;if(t.type||(i="application/json"),!(i!=null&&i.endsWith("json"))&&i!=="speculationrules")return;t.type=i,e.props.type=i,e[n]=JSON.stringify(s)}else e[n]=s;return}const o=String(s),c=n.startsWith("data-");o==="true"||o===""?e.props[n]=c?o:!0:!s&&c&&o==="false"?e.props[n]="false":s!==void 0&&(e.props[n]=s)}),e}function v(e,t){const n=typeof t=="object"&&typeof t!="function"?t:{[e==="script"||e==="noscript"||e==="style"?"innerHTML":"textContent"]:t},s=R({tag:e,props:{}},n);return s.key&&G.has(s.tag)&&(s.props["data-hid"]=s._h=s.key),s.tag==="script"&&typeof s.innerHTML=="object"&&(s.innerHTML=JSON.stringify(s.innerHTML),s.props.type=s.props.type||"application/json"),Array.isArray(s.props.content)?s.props.content.map(o=>({...s,props:{...s.props,content:o}})):s}function ee(e,t){if(!e)return[];typeof e=="function"&&(e=e());const n=(o,c)=>{for(let i=0;i<t.length;i++)c=t[i](o,c);return c};e=n(void 0,e);const s=[];return e=H(e,n),Object.entries(e||{}).forEach(([o,c])=>{if(c!==void 0)for(const i of Array.isArray(c)?c:[c])s.push(v(o,i))}),s.flat()}const L=(e,t)=>e._w===t._w?e._p-t._p:e._w-t._w,x={base:-10,title:10},te={critical:-8,high:-1,low:2},I={meta:{"content-security-policy":-30,charset:-20,viewport:-15},link:{preconnect:20,stylesheet:60,preload:70,modulepreload:70,prefetch:90,"dns-prefetch":90,prerender:90},script:{async:30,defer:80,sync:50},style:{imported:40,sync:60}},ne=/@import/,S=e=>e===""||e===!0;function re(e,t){var c;if(typeof t.tagPriority=="number")return t.tagPriority;let n=100;const s=te[t.tagPriority]||0,o=e.resolvedOptions.disableCapoSorting?{link:{},script:{},style:{}}:I;if(t.tag in x)n=x[t.tag];else if(t.tag==="meta"){const i=t.props["http-equiv"]==="content-security-policy"?"content-security-policy":t.props.charset?"charset":t.props.name==="viewport"?"viewport":null;i&&(n=I.meta[i])}else t.tag==="link"&&t.props.rel?n=o.link[t.props.rel]:t.tag==="script"?S(t.props.async)?n=o.script.async:t.props.src&&!S(t.props.defer)&&!S(t.props.async)&&t.props.type!=="module"&&!((c=t.props.type)!=null&&c.endsWith("json"))?n=o.script.sync:S(t.props.defer)&&t.props.src&&!S(t.props.async)&&(n=o.script.defer):t.tag==="style"&&(n=t.innerHTML&&ne.test(t.innerHTML)?o.style.imported:o.style.sync);return(n||100)+s}function U(e,t){const n=typeof t=="function"?t(e):t,s=n.key||String(e.plugins.size+1);e.plugins.get(s)||(e.plugins.set(s,n),e.hooks.addHooks(n.hooks||{}))}function oe(e={}){var f;const t=F();t.addHooks(e.hooks||{});const n=!e.document,s=new Map,o=new Map,c=[],i={_entryCount:1,plugins:o,dirty:!1,resolvedOptions:e,hooks:t,ssr:n,entries:s,headEntries(){return[...s.values()]},use:p=>U(i,p),push(p,g){const y={...g||{}};delete y.head;const m=y._index??i._entryCount++,_={_i:m,input:p,options:y},T={_poll(a=!1){i.dirty=!0,!a&&c.push(m),t.callHook("entries:updated",i)},dispose(){s.delete(m)&&T._poll(!0)},patch(a){(!y.mode||y.mode==="server"&&n||y.mode==="client"&&!n)&&(_.input=a,s.set(m,_),T._poll())}};return T.patch(p),T},async resolveTags(){var T;const p={tagMap:new Map,tags:[],entries:[...i.entries.values()]};for(await t.callHook("entries:resolve",p);c.length;){const a=c.shift(),r=s.get(a);if(r){const l={tags:ee(r.input,e.propResolvers||[]).map(u=>Object.assign(u,r.options)),entry:r};await t.callHook("entries:normalize",l),r._tags=l.tags.map((u,d)=>(u._w=re(i,u),u._p=(r._i<<10)+d,u._d=E(u),u))}}let g=!1;p.entries.flatMap(a=>(a._tags||[]).map(r=>({...r,props:{...r.props}}))).sort(L).reduce((a,r)=>{const l=String(r._d||r._p);if(!a.has(l))return a.set(l,r);const u=a.get(l);if(((r==null?void 0:r.tagDuplicateStrategy)||(Z.has(r.tag)?"merge":null)||(r.key&&r.key===u.key?"merge":null))==="merge"){const h={...u.props};Object.entries(r.props).forEach(([w,b])=>h[w]=w==="style"?new Map([...u.props.style||new Map,...b]):w==="class"?new Set([...u.props.class||new Set,...b]):b),a.set(l,{...r,props:h})}else r._p>>10===u._p>>10&&K(r._d)?(a.set(l,Object.assign([...Array.isArray(u)?u:[u],r],r)),g=!0):(r._w===u._w?r._p>u._p:(r==null?void 0:r._w)<(u==null?void 0:u._w))&&a.set(l,r);return a},p.tagMap);const y=p.tagMap.get("title"),m=p.tagMap.get("titleTemplate");if(i._title=y==null?void 0:y.textContent,m){const a=m==null?void 0:m.textContent;if(i._titleTemplate=a,a){let r=typeof a=="function"?a(y==null?void 0:y.textContent):a;typeof r=="string"&&!i.plugins.has("template-params")&&(r=r.replace("%s",(y==null?void 0:y.textContent)||"")),y?r===null?p.tagMap.delete("title"):p.tagMap.set("title",{...y,textContent:r}):(m.tag="title",m.textContent=r)}}p.tags=Array.from(p.tagMap.values()),g&&(p.tags=p.tags.flat().sort(L)),await t.callHook("tags:beforeResolve",p),await t.callHook("tags:resolve",p),await t.callHook("tags:afterResolve",p);const _=[];for(const a of p.tags){const{innerHTML:r,tag:l,props:u}=a;if(J.has(l)&&!(Object.keys(u).length===0&&!a.innerHTML&&!a.textContent)&&!(l==="meta"&&!u.content&&!u["http-equiv"]&&!u.charset)){if(l==="script"&&r){if((T=u.type)!=null&&T.endsWith("json")){const d=typeof r=="string"?r:JSON.stringify(r);a.innerHTML=d.replace(/</g,"\\u003C")}else typeof r=="string"&&(a.innerHTML=r.replace(new RegExp(`</${l}`,"g"),`<\\/${l}`));a._d=E(a)}_.push(a)}}return _}};return((e==null?void 0:e.plugins)||[]).forEach(p=>U(i,p)),i.hooks.callHook("init",i),(f=e.init)==null||f.forEach(p=>p&&i.push(p)),i}async function se(e,t={}){const n=t.document||e.resolvedOptions.document;if(!n||!e.dirty)return;const s={shouldRender:!0,tags:[]};if(await e.hooks.callHook("dom:beforeRender",s),!!s.shouldRender)return e._domUpdatePromise||(e._domUpdatePromise=new Promise(async o=>{var T;const c=new Map,i=new Promise(a=>{e.resolveTags().then(r=>{a(r.map(l=>{const u=c.get(l._d)||0,d={tag:l,id:(u?`${l._d}:${u}`:l._d)||O(l),shouldRender:!0};return l._d&&K(l._d)&&c.set(l._d,u+1),d}))})});let f=e._dom;if(!f){f={title:n.title,elMap:new Map().set("htmlAttrs",n.documentElement).set("bodyAttrs",n.body)};for(const a of["body","head"]){const r=(T=n[a])==null?void 0:T.children;for(const l of r){const u=l.tagName.toLowerCase();if(!$.has(u))continue;const d=R({tag:u,props:{}},{innerHTML:l.innerHTML,...l.getAttributeNames().reduce((h,w)=>(h[w]=l.getAttribute(w),h),{})||{}});if(d.key=l.getAttribute("data-hid")||void 0,d._d=E(d)||O(d),f.elMap.has(d._d)){let h=1,w=d._d;for(;f.elMap.has(w);)w=`${d._d}:${h++}`;f.elMap.set(w,l)}else f.elMap.set(d._d,l)}}}f.pendingSideEffects={...f.sideEffects},f.sideEffects={};function p(a,r,l){const u=`${a}:${r}`;f.sideEffects[u]=l,delete f.pendingSideEffects[u]}function g({id:a,$el:r,tag:l}){const u=l.tag.endsWith("Attrs");f.elMap.set(a,r),u||(l.textContent&&l.textContent!==r.textContent&&(r.textContent=l.textContent),l.innerHTML&&l.innerHTML!==r.innerHTML&&(r.innerHTML=l.innerHTML),p(a,"el",()=>{r==null||r.remove(),f.elMap.delete(a)}));for(const d in l.props){if(!Object.prototype.hasOwnProperty.call(l.props,d))continue;const h=l.props[d];if(d.startsWith("on")&&typeof h=="function"){const b=r==null?void 0:r.dataset;if(b&&b[`${d}fired`]){const k=d.slice(0,-5);h.call(r,new Event(k.substring(2)))}r.getAttribute(`data-${d}`)!==""&&((l.tag==="bodyAttrs"?n.defaultView:r).addEventListener(d.substring(2),h.bind(r)),r.setAttribute(`data-${d}`,""));continue}const w=`attr:${d}`;if(d==="class"){if(!h)continue;for(const b of h)u&&p(a,`${w}:${b}`,()=>r.classList.remove(b)),!r.classList.contains(b)&&r.classList.add(b)}else if(d==="style"){if(!h)continue;for(const[b,k]of h)p(a,`${w}:${b}`,()=>{r.style.removeProperty(b)}),r.style.setProperty(b,k)}else h!==!1&&h!==null&&(r.getAttribute(d)!==h&&r.setAttribute(d,h===!0?"":String(h)),u&&p(a,w,()=>r.removeAttribute(d)))}}const y=[],m={bodyClose:void 0,bodyOpen:void 0,head:void 0},_=await i;for(const a of _){const{tag:r,shouldRender:l,id:u}=a;if(l){if(r.tag==="title"){n.title=r.textContent,p("title","",()=>n.title=f.title);continue}a.$el=a.$el||f.elMap.get(u),a.$el?g(a):$.has(r.tag)&&y.push(a)}}for(const a of y){const r=a.tag.tagPosition||"head";a.$el=n.createElement(a.tag.tag),g(a),m[r]=m[r]||n.createDocumentFragment(),m[r].appendChild(a.$el)}for(const a of _)await e.hooks.callHook("dom:renderTag",a,n,p);m.head&&n.head.appendChild(m.head),m.bodyOpen&&n.body.insertBefore(m.bodyOpen,n.body.firstChild),m.bodyClose&&n.body.appendChild(m.bodyClose);for(const a in f.pendingSideEffects)f.pendingSideEffects[a]();e._dom=f,await e.hooks.callHook("dom:rendered",{renders:_}),o()}).finally(()=>{e._domUpdatePromise=void 0,e.dirty=!1})),e._domUpdatePromise}function le(e={}){var s,o,c;const t=((s=e.domOptions)==null?void 0:s.render)||se;e.document=e.document||(typeof window<"u"?document:void 0);const n=((c=(o=e.document)==null?void 0:o.head.querySelector('script[id="unhead:payload"]'))==null?void 0:c.innerHTML)||!1;return oe({...e,plugins:[...e.plugins||[],{key:"client",hooks:{"entries:updated":t}}],init:[n?JSON.parse(n):!1,...e.init||[]]})}function fe(e,t){let n=0;return()=>{const s=++n;t(()=>{n===s&&e()})}}const A={META:new Set(["twitter"]),OG:new Set(["og","book","article","profile","fb"]),MEDIA:new Set(["ogImage","ogVideo","ogAudio","twitterImage"]),HTTP_EQUIV:new Set(["contentType","defaultStyle","xUaCompatible"])},ie={articleExpirationTime:"article:expiration_time",articleModifiedTime:"article:modified_time",articlePublishedTime:"article:published_time",bookReleaseDate:"book:release_date",fbAppId:"fb:app_id",ogAudioSecureUrl:"og:audio:secure_url",ogAudioUrl:"og:audio",ogImageSecureUrl:"og:image:secure_url",ogImageUrl:"og:image",ogSiteName:"og:site_name",ogVideoSecureUrl:"og:video:secure_url",ogVideoUrl:"og:video",profileFirstName:"profile:first_name",profileLastName:"profile:last_name",profileUsername:"profile:username",msapplicationConfig:"msapplication-Config",msapplicationTileColor:"msapplication-TileColor",msapplicationTileImage:"msapplication-TileImage"},q={appleItunesApp:{unpack:{entrySeparator:", ",resolve:({key:e,value:t})=>`${M(e)}=${t}`}},refresh:{metaKey:"http-equiv",unpack:{entrySeparator:";",resolve:({key:e,value:t})=>e==="seconds"?`${t}`:void 0}},robots:{unpack:{entrySeparator:", ",resolve:({key:e,value:t})=>typeof t=="boolean"?M(e):`${M(e)}:${t}`}},contentSecurityPolicy:{metaKey:"http-equiv",unpack:{entrySeparator:"; ",resolve:({key:e,value:t})=>`${M(e)} ${t}`}},charset:{}};function M(e){const t=e.replace(/([A-Z])/g,"-$1").toLowerCase(),n=t.indexOf("-");return n===-1?t:A.META.has(t.slice(0,n))||A.OG.has(t.slice(0,n))?e.replace(/([A-Z])/g,":$1").toLowerCase():t}function z(e){return Object.fromEntries(Object.entries(e).filter(([t,n])=>String(n)!=="false"&&t))}function j(e){return Array.isArray(e)?e.map(j):!e||typeof e!="object"?e:Object.fromEntries(Object.entries(e).map(([t,n])=>[M(t),j(n)]))}function D(e,t={}){const{entrySeparator:n="",keyValueSeparator:s="",wrapValue:o,resolve:c}=t;return Object.entries(e).map(([i,f])=>{if(c){const g=c({key:i,value:f});if(g!==void 0)return g}const p=typeof f=="object"?D(f,t):typeof f=="number"?f.toString():typeof f=="string"&&o?`${o}${f.replace(new RegExp(o,"g"),`\\${o}`)}${o}`:f;return`${i}${s}${p}`}).join(n)}function V(e,t){const n=z(t),s=M(e),o=W(s);if(!P.has(s))return[{[o]:s,...n}];const c=Object.fromEntries(Object.entries(n).map(([i,f])=>[`${e}${i==="url"?"":`${i[0].toUpperCase()}${i.slice(1)}`}`,f]));return C(c||{}).sort((i,f)=>{var p,g;return(((p=i[o])==null?void 0:p.length)||0)-(((g=f[o])==null?void 0:g.length)||0)})}function W(e){var s;if(((s=q[e])==null?void 0:s.metaKey)==="http-equiv"||A.HTTP_EQUIV.has(e))return"http-equiv";const t=M(e),n=t.indexOf(":");return n===-1?"name":A.OG.has(t.slice(0,n))?"property":"name"}function ce(e){return ie[e]||M(e)}function ae(e,t){var n;return t==="refresh"?`${e.seconds};url=${e.url}`:D(j(e),{keyValueSeparator:"=",entrySeparator:", ",resolve:({value:s,key:o})=>s===null?"":typeof s=="boolean"?o:void 0,...(n=q[t])==null?void 0:n.unpack})}function C(e){const t=[],n={};for(const[o,c]of Object.entries(e)){if(Array.isArray(c)){if(o==="themeColor"){c.forEach(i=>{typeof i=="object"&&i!==null&&t.push({name:"theme-color",...i})});continue}for(const i of c)if(typeof i=="object"&&i!==null){const f=[],p=[];for(const[g,y]of Object.entries(i)){const m=`${o}${g==="url"?"":`:${g}`}`,_=C({[m]:y});(g==="url"?f:p).push(..._)}t.push(...f,...p)}else t.push(...typeof i=="string"?C({[o]:i}):V(o,i));continue}if(typeof c=="object"&&c)if(A.MEDIA.has(o)){const i=o.startsWith("twitter")?"twitter":"og",f=o.replace(/^(og|twitter)/,"").toLowerCase(),p=i==="twitter"?"name":"property";c.url&&t.push({[p]:`${i}:${f}`,content:c.url}),c.secureUrl&&t.push({[p]:`${i}:${f}:secure_url`,content:c.secureUrl});for(const[g,y]of Object.entries(c))g!=="url"&&g!=="secureUrl"&&t.push({[p]:`${i}:${f}:${g}`,content:y})}else P.has(M(o))?t.push(...V(o,c)):n[o]=z(c);else n[o]=c}const s=Object.entries(n).map(([o,c])=>{if(o==="charset")return{charset:c===null?"_null":c};const i=W(o),f=ce(o),p=c===null?"_null":typeof c=="object"?ae(c,o):typeof c=="number"?c.toString():c;return i==="http-equiv"?{"http-equiv":f,content:p}:{[i]:f,content:p}});return[...t,...s].map(o=>"content"in o&&o.content==="_null"?{...o,content:null}:o)}const ue={key:"flatMeta",hooks:{"entries:normalize":e=>{const t=[];e.tags=e.tags.map(n=>n.tag!=="_flatMeta"?n:(t.push(C(n.props).map(s=>({...n,tag:"meta",props:s}))),!1)).filter(Boolean).concat(...t)}}};export{ue as F,fe as a,le as c,se as r,H as w};
