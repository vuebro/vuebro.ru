import{r as _}from"./babel-helper-member-expression-to-functions-BwEbAO2d.js";import{r as H}from"./babel-helper-optimise-call-expression-CHv22ECX.js";import{r as L}from"./babel-core-Bs32w3bm.js";import{r as w}from"./babel-traverse-CY8MFp_n.js";var h={},P;function B(){if(P)return h;P=1,Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;var R=_(),m=H(),o=L(),y=w();const{assignmentExpression:x,callExpression:a,cloneNode:i,identifier:f,memberExpression:l,sequenceExpression:d,stringLiteral:g,thisExpression:n}=o.types;h.environmentVisitor=y.visitors.environmentVisitor({}),h.skipAllButComputedKey=function(e){e.skip(),e.node.computed&&e.context.maybeQueue(e.get("key"))};const v=y.visitors.environmentVisitor({Super(t,e){const{node:r,parentPath:s}=t;s.isMemberExpression({object:r})&&e.handle(s)}}),E=y.visitors.environmentVisitor({Scopable(t,{refName:e}){const r=t.scope.getOwnBinding(e);r&&r.identifier.name===e&&t.scope.rename(e)}}),b={memoise(t,e){const{scope:r,node:s}=t,{computed:c,property:p}=s;if(!c)return;const u=r.maybeGenerateMemoised(p);u&&this.memoiser.set(p,u,e)},prop(t){const{computed:e,property:r}=t.node;return this.memoiser.has(r)?i(this.memoiser.get(r)):e?i(r):g(r.name)},_getPrototypeOfExpression(){const t=i(this.getObjectRef()),e=this.isStatic||this.isPrivateMethod?t:l(t,f("prototype"));return a(this.file.addHelper("getPrototypeOf"),[e])},get(t){const e=i(this.getObjectRef());return a(this.file.addHelper("superPropGet"),[this.isDerivedConstructor?d([n(),e]):e,this.prop(t),n(),...this.isStatic||this.isPrivateMethod?[]:[o.types.numericLiteral(1)]])},_call(t,e,r){const s=i(this.getObjectRef());let c;e.length===1&&o.types.isSpreadElement(e[0])&&(o.types.isIdentifier(e[0].argument)||o.types.isArrayExpression(e[0].argument))?c=e[0].argument:c=o.types.arrayExpression(e);const p=o.types.callExpression(this.file.addHelper("superPropGet"),[this.isDerivedConstructor?d([n(),s]):s,this.prop(t),n(),o.types.numericLiteral(2|(this.isStatic||this.isPrivateMethod?0:1))]);return r?o.types.optionalCallExpression(p,[c],!0):a(p,[c])},set(t,e){const r=i(this.getObjectRef());return a(this.file.addHelper("superPropSet"),[this.isDerivedConstructor?d([n(),r]):r,this.prop(t),e,n(),o.types.numericLiteral(t.isInStrictMode()?1:0),...this.isStatic||this.isPrivateMethod?[]:[o.types.numericLiteral(1)]])},destructureSet(t){throw t.buildCodeFrameError("Destructuring to a super field is not supported yet.")},call(t,e){return this._call(t,e,!1)},optionalCall(t,e){return this._call(t,e,!0)},delete(t){return t.node.computed?d([a(this.file.addHelper("toPropertyKey"),[i(t.node.property)]),o.template.expression.ast`
          function () { throw new ReferenceError("'delete super[expr]' is invalid"); }()
        `]):o.template.expression.ast`
        function () { throw new ReferenceError("'delete super.prop' is invalid"); }()
      `}},j={memoise(t,e){const{scope:r,node:s}=t,{computed:c,property:p}=s;if(!c)return;const u=r.maybeGenerateMemoised(p);u&&this.memoiser.set(p,u,e)},prop(t){const{computed:e,property:r}=t.node;return this.memoiser.has(r)?i(this.memoiser.get(r)):e?i(r):g(r.name)},_getPrototypeOfExpression(){const t=i(this.getObjectRef()),e=this.isStatic||this.isPrivateMethod?t:l(t,f("prototype"));return a(this.file.addHelper("getPrototypeOf"),[e])},get(t){return this._get(t)},_get(t){const e=this._getPrototypeOfExpression();return a(this.file.addHelper("get"),[this.isDerivedConstructor?d([n(),e]):e,this.prop(t),n()])},set(t,e){const r=this._getPrototypeOfExpression();return a(this.file.addHelper("set"),[this.isDerivedConstructor?d([n(),r]):r,this.prop(t),e,n(),o.types.booleanLiteral(t.isInStrictMode())])},destructureSet(t){throw t.buildCodeFrameError("Destructuring to a super field is not supported yet.")},call(t,e){return(0,m.default)(this._get(t),n(),e,!1)},optionalCall(t,e){return(0,m.default)(this._get(t),i(n()),e,!0)},delete(t){return t.node.computed?d([a(this.file.addHelper("toPropertyKey"),[i(t.node.property)]),o.template.expression.ast`
          function () { throw new ReferenceError("'delete super[expr]' is invalid"); }()
        `]):o.template.expression.ast`
        function () { throw new ReferenceError("'delete super.prop' is invalid"); }()
      `}},O=Object.assign({},b,{prop(t){const{property:e}=t.node;return this.memoiser.has(e)?i(this.memoiser.get(e)):i(e)},get(t){const{isStatic:e,getSuperRef:r}=this,{computed:s}=t.node,c=this.prop(t);let p;if(e){var u;p=(u=r())!=null?u:l(f("Function"),f("prototype"))}else{var S;p=l((S=r())!=null?S:f("Object"),f("prototype"))}return l(p,c,s)},set(t,e){const{computed:r}=t.node,s=this.prop(t);return x("=",l(n(),s,r),e)},destructureSet(t){const{computed:e}=t.node,r=this.prop(t);return l(n(),r,e)},call(t,e){return(0,m.default)(this.get(t),n(),e,!1)},optionalCall(t,e){return(0,m.default)(this.get(t),n(),e,!0)}});class C{constructor(e){var r;const s=e.methodPath;this.methodPath=s,this.isDerivedConstructor=s.isClassMethod({kind:"constructor"})&&!!e.superRef,this.isStatic=s.isObjectMethod()||s.node.static||(s.isStaticBlock==null?void 0:s.isStaticBlock()),this.isPrivateMethod=s.isPrivate()&&s.isMethod(),this.file=e.file,this.constantSuper=(r=e.constantSuper)!=null?r:e.isLoose,this.opts=e}getObjectRef(){return i(this.opts.objectRef||this.opts.getObjectRef())}getSuperRef(){if(this.opts.superRef)return i(this.opts.superRef);if(this.opts.getSuperRef)return i(this.opts.getSuperRef())}replace(){const{methodPath:e}=this;this.opts.refToPreserve&&e.traverse(E,{refName:this.opts.refToPreserve.name});const r=this.constantSuper?O:this.file.availableHelper("superPropSet")?b:j;v.shouldSkip=s=>{if(s.parentPath===e&&(s.parentKey==="decorators"||s.parentKey==="key"))return!0},(0,R.default)(e,v,Object.assign({file:this.file,scope:this.methodPath.scope,isDerivedConstructor:this.isDerivedConstructor,isStatic:this.isStatic,isPrivateMethod:this.isPrivateMethod,getObjectRef:this.getObjectRef.bind(this),getSuperRef:this.getSuperRef.bind(this),boundGet:r.get},r))}}return h.default=C,h}export{B as r};
