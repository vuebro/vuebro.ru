import{defineComponent as e,ref as t,computed as s,watch as a,onUnmounted as r,createElementBlock as o,openBlock as i,Fragment as n,renderList as l,normalizeClass as u,createBlock as d,resolveDynamicComponent as c}from"vue";import{u as p,e as v,h as f,p as m,d as h}from"./shared-C5IlS6fE.js";import{useRoute as g,useRouter as b}from"vue-router";import{t as w,p as _,m as M,r as j,a as S,s as V,_ as k}from"./index-BOfjvODv.js";import"./unocss-B9TFO0os.js";import"@vuebro/loader-sfc";const x=["id","role"];const E=k(e({__name:"PageView",setup(e,{expose:o}){o();const i=t([]),n=g(),l=b(),u=s(()=>w.value?.siblings??[]),d=[],c=s(()=>u.value.filter(({enabled:e})=>e)),k=()=>{d.forEach(e=>{e()}),d.length=0},x=s(()=>void 0===w.value||w.value.parent?.flat?c.value:[w.value]),E=s(()=>new Map(x.value.map(({id:e=p()})=>[e,!1]))),P=t(new Map(E.value)),$=s(()=>{const[[e,t]=[]]=_;return _.clear(),e&&t&&_.set(e,t),Object.fromEntries(x.value.map(e=>[e.id,M(e)]))});a(i,e=>{k(),setTimeout(()=>{e.forEach(e=>{const{stop:t}=v(e,([{isIntersecting:e,target:{id:t}={}}={}]=[])=>{P.value=new Map(E.value),t&&void 0!==e&&E.value.set(t,e)},{threshold:.1});d.push(t)})})},{deep:!0}),f(window,{behavior:"smooth",onStop:()=>{if(!S.value){const{scrollX:e,scrollY:t}=window,[s]=x.value,[a]=m.value;if(a&&s){const{$children:[{id:r}={}]=[]}=a,o=Math.floor(e)||Math.floor(t)||s.id!==r?[...E.value.entries()].find(([,e])=>e)?.[0]??[...P.value.entries()].find(([,e])=>e)?.[0]??s.id:a.id;o!==n.name&&(V.value=!1,l.push({name:o}).catch(h))}}}}),r(k);const y={refs:i,route:n,router:l,siblings:u,stops:d,$siblings:c,clearStops:k,these:x,intersecting:E,$intersecting:P,templates:$,get uid(){return p},get resolve(){return j},get that(){return w}};return Object.defineProperty(y,"__isScriptSetup",{enumerable:!1,value:!0}),y}}),[["render",function(e,t,s,a,r,p){return i(!0),o(n,null,l(a.these,e=>(i(),o("div",{id:e.id??a.uid(),key:e.id??a.uid(),ref_for:!0,ref:"refs",class:u(e.class),role:e.id===a.that?.id?"main":"section","un-cloak":""},[(i(),d(c(a.templates[e.id]),{id:e.id,"un-cloak":"",onVnodeMounted:t=>a.resolve(e)},null,8,["id","onVnodeMounted"]))],10,x))),128)}],["__file","PageView.vue"]]);export{E as default};
