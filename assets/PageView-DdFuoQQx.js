import{computed as g,toValue as h,shallowRef as I,watch as j,reactive as K,getCurrentInstance as se,onMounted as re,unref as V,defineComponent as ie,ref as Q,onUnmounted as ue,createElementBlock as Z,openBlock as B,Fragment as ae,renderList as ce,normalizeClass as de,createBlock as ve,resolveDynamicComponent as fe}from"vue";import{u as F,p as pe}from"./shared-DEqMO6gr.js";import{t as W,n as oe,a as A,b as z,c as me,i as he,w as be,d as Ee,u as Me,e as ge,f as x,p as X,m as Se,r as we,g as _e,s as ye,h as Oe}from"./index-B6NwJWow.js";import{useRoute as Te,useRouter as Le}from"vue-router";import"./unocss-C5ejlI-Z.js";import"@vuebro/loader-sfc";const P=he?window:void 0;function D(t){var u;const a=h(t);return(u=a?.$el)!==null&&u!==void 0?u:a}function ee(...t){const u=[],a=()=>{u.forEach(o=>o()),u.length=0},S=(o,n,i,l)=>(o.addEventListener(n,i,l),()=>o.removeEventListener(n,i,l)),b=g(()=>{const o=W(h(t[0])).filter(n=>n!=null);return o.every(n=>typeof n!="string")?o:void 0}),c=be(()=>{var o,n;return[(o=(n=b.value)===null||n===void 0?void 0:n.map(i=>D(i)))!==null&&o!==void 0?o:[P].filter(i=>i!=null),W(h(b.value?t[1]:t[0])),W(V(b.value?t[2]:t[1])),h(b.value?t[3]:t[2])]},([o,n,i,l])=>{if(a(),!o?.length||!n?.length||!i?.length)return;const v=Ee(l)?{...l}:l;u.push(...o.flatMap(r=>n.flatMap(d=>i.map(s=>S(r,d,s,v)))))},{flush:"post"}),f=()=>{c(),a()};return z(a),f}function $e(){const t=I(!1),u=se();return u&&re(()=>{t.value=!0},u),t}function ne(t){const u=$e();return g(()=>(u.value,!!t()))}function ke(t,u,a={}){const{window:S=P,...b}=a;let c;const f=ne(()=>S&&"MutationObserver"in S),o=()=>{c&&(c.disconnect(),c=void 0)},n=j(g(()=>{const v=W(h(t)).map(D).filter(oe);return new Set(v)}),v=>{o(),f.value&&v.size&&(c=new MutationObserver(u),v.forEach(r=>c.observe(r,b)))},{immediate:!0,flush:"post"}),i=()=>c?.takeRecords(),l=()=>{n(),o()};return z(l),{isSupported:f,stop:l,takeRecords:i}}function Ce(t,u,a={}){const{root:S,rootMargin:b="0px",threshold:c=0,window:f=P,immediate:o=!0}=a,n=ne(()=>f&&"IntersectionObserver"in f),i=g(()=>W(h(t)).map(D).filter(oe));let l=A;const v=I(o),r=n.value?j(()=>[i.value,D(S),v.value],([s,p])=>{if(l(),!v.value||!s.length)return;const E=new IntersectionObserver(u,{root:D(p),rootMargin:b,threshold:c});s.forEach(O=>O&&E.observe(O)),l=()=>{E.disconnect(),l=A}},{immediate:o,flush:"post"}):A,d=()=>{l(),r(),v.value=!1};return z(d),{isSupported:n,isActive:v,pause(){l(),v.value=!1},resume(){v.value=!0},stop:d}}const te=1;function De(t,u={}){const{throttle:a=0,idle:S=200,onStop:b=A,onScroll:c=A,offset:f={left:0,right:0,top:0,bottom:0},observe:o={mutation:!1},eventListenerOptions:n={capture:!1,passive:!0},behavior:i="auto",window:l=P,onError:v=e=>{console.error(e)}}=u,r=typeof o=="boolean"?{mutation:o}:o,d=I(0),s=I(0),p=g({get(){return d.value},set(e){O(e,void 0)}}),E=g({get(){return s.value},set(e){O(void 0,e)}});function O(e,y){var M,k,C,R;if(!l)return;const m=h(t);if(!m)return;(M=m instanceof Document?l.document.body:m)===null||M===void 0||M.scrollTo({top:(k=h(y))!==null&&k!==void 0?k:E.value,left:(C=h(e))!==null&&C!==void 0?C:p.value,behavior:h(i)});const L=(m==null||(R=m.document)===null||R===void 0?void 0:R.documentElement)||m?.documentElement||m;p!=null&&(d.value=L.scrollLeft),E!=null&&(s.value=L.scrollTop)}const T=I(!1),w=K({left:!0,right:!1,top:!0,bottom:!1}),_=K({left:!1,right:!1,top:!1,bottom:!1}),Y=e=>{T.value&&(T.value=!1,_.left=!1,_.right=!1,_.top=!1,_.bottom=!1,b(e))},le=ge(Y,a+S),H=e=>{var y;if(!l)return;const M=(e==null||(y=e.document)===null||y===void 0?void 0:y.documentElement)||e?.documentElement||D(e),{display:k,flexDirection:C,direction:R}=getComputedStyle(M),m=R==="rtl"?-1:1,L=M.scrollLeft;_.left=L<d.value,_.right=L>d.value;const U=Math.abs(L*m)<=(f.left||0),q=Math.abs(L*m)+M.clientWidth>=M.scrollWidth-(f.right||0)-te;k==="flex"&&C==="row-reverse"?(w.left=q,w.right=U):(w.left=U,w.right=q),d.value=L;let $=M.scrollTop;e===l.document&&!$&&($=l.document.body.scrollTop),_.top=$<s.value,_.bottom=$>s.value;const G=Math.abs($)<=(f.top||0),J=Math.abs($)+M.clientHeight>=M.scrollHeight-(f.bottom||0)-te;k==="flex"&&C==="column-reverse"?(w.top=J,w.bottom=G):(w.top=G,w.bottom=J),s.value=$},N=e=>{var y;l&&(H((y=e.target.documentElement)!==null&&y!==void 0?y:e.target),T.value=!0,le(e),c(e))};return ee(t,"scroll",a?Me(N,a,!0,!1):N,n),me(()=>{try{const e=h(t);if(!e)return;H(e)}catch(e){v(e)}}),r?.mutation&&t!=null&&t!==l&&t!==document&&ke(t,()=>{const e=h(t);e&&H(e)},{attributes:!0,childList:!0,subtree:!0}),ee(t,"scrollend",Y,n),{x:p,y:E,isScrolling:T,arrivedState:w,directions:_,measure(){const e=h(t);l&&e&&H(e)}}}const Re=["id","role"],Pe=ie({__name:"PageView",setup(t){const u=Q([]),a=Te(),S=Le(),b=g(()=>x.value?.siblings??[]),c=[],f=g(()=>b.value.filter(({enabled:r})=>r)),o=()=>{c.forEach(r=>{r()}),c.length=0},n=g(()=>x.value===void 0||x.value.parent?.flat?f.value:[x.value]),i=g(()=>new Map(n.value.map(({id:r=F()})=>[r,!1]))),l=Q(new Map(i.value)),v=g(()=>{const[[r,d]=[]]=X;return X.clear(),r&&d&&X.set(r,d),Object.fromEntries(n.value.map(s=>[s.id,Se(s)]))});return j(u,r=>{o(),setTimeout(()=>{r.forEach(d=>{const{stop:s}=Ce(d,([{isIntersecting:p,target:{id:E}={}}={}]=[])=>{l.value=new Map(i.value),E&&p!==void 0&&i.value.set(E,p)},{threshold:.1});c.push(s)})})},{deep:!0}),De(window,{behavior:"smooth",onStop:()=>{if(!_e.value){const{scrollX:r,scrollY:d}=window,[s]=n.value,[p]=pe.value;if(p&&s){const{$children:[{id:E}={}]=[]}=p,O=!Math.floor(r)&&!Math.floor(d)&&s.id===E?p.id:[...i.value.entries()].find(([,T])=>T)?.[0]??[...l.value.entries()].find(([,T])=>T)?.[0]??s.id;O!==a.name&&(ye.value=!1,S.push({name:O}).catch(Oe.error))}}}}),ue(o),(r,d)=>(B(!0),Z(ae,null,ce(n.value,s=>(B(),Z("div",{id:s.id??V(F)(),key:s.id??V(F)(),ref_for:!0,ref_key:"refs",ref:u,class:de(s.class),role:s.id===V(x)?.id?"main":"section","un-cloak":""},[(B(),ve(fe(v.value[s.id]),{pid:s.id,onVnodeMounted:p=>V(we)(s)},null,8,["pid","onVnodeMounted"]))],10,Re))),128))}});export{Pe as default};
